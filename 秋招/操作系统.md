## 操作系统 ##



---

#### 死锁 ####

---

__死锁的发生条件__

死锁是指多个进程因竞争资源而造成的一种互相等待的僵局，如果没有外力的作用，这些进程无法继续推进下去

死锁产生的两个原因：1.对系统不可剥夺资源的竞争 2.进程推进顺序非法，请求和释放资源的顺序不合理

死锁产生的四个必要条件：互斥条件、不剥夺条件、请求并保持条件、循环等待条件

__死锁处理策略__

___a.死锁预防___

破坏死锁产生的四个必要条件之一

破坏互斥条件：允许资源能共享使用，不太可行

破坏不剥夺条件：当一个已经保持了某些不可剥夺资源的进程请求新的资源而不能得到满足时，它必须释放已经保持的所有资源

破坏请求并保持条件：进程在运行前一次性申请完所有需要的资源，在它的资源未被满足前，不把他投入运行

破坏循环等待条件：给系统资源编号，规定每个进程必须按照编号递增的顺序请求资源

___b.死锁避免___

在资源的动态分配过程中，防止系统进入不安全状态，以避免发生死锁

著名死锁避免算法：银行家算法，把操作系统当作银行家，资源当作银行家管理的资金，进程向操作系统请求资源相当于用户向银行家贷款。进程运行之前需要声明对各种资源的最大需求量，当进程在运行过程中继续申请资源时，需要先测试该进程已占用的资源数和当前申请的资源数之和是否超过最大需求量，超过则拒绝分配；然后测试系统现存的资源能否满足该进程的需求，不满足则拒绝分配，满足的话需要测试是否符合安全性算法，符合才能进行分配。

___c.死锁检测和消除___

建立当前状态S的资源分配图，圆圈代表进程，方框代表一类资源，进程到资源的有向边代表该进程请求该资源，资源到进程的有向边代表该资源已经有多少个分配给了该进程

资源分配图简化：找出一个既不阻塞也不是孤点的进程，如果它所有的边都满足申请资源的数量小于系统中已有的空闲资源数量，那么就可以去掉与之相连的所有边，如果最终所有边都可以被去掉，那么这个图就是可以被完全简化的

死锁定理：当且仅当S的资源分配图是不可完全简化的才发生死锁

死锁解除：资源剥夺、撤销进程、进程回退



---

#### 线程进程协程 ####

---

__定义__

进程是进程实体(包括程序段、数据段和PCB)的运行过程，是系统进行资源分配的基本单位

线程是进程中的一条执行流程，由线程ID、程序计数器、寄存器集和堆栈组成，是程序执行的基本单位

协程是用户态的轻量级线程，协程的调度完全由用户控制，没有内核切换的开销



__对比__

___a.定义上___

进程是资源分配的基本单位，线程是程序执行的基本单位，协程是用户态的轻量级线程

___b.系统开销___

进程需要切换到内核态，需要切换虚拟内存地址，需要切换栈和寄存器等

线程需要切换到内核态，不需要切换虚拟内存地址，需要切换少量的寄存器内容

协程不需要切换内核态，更不需要切换虚拟内存地址，上下文切换速度非常快

___c.内存分配___

进程之间的地址空间和资源是独立的，而同一进程的线程和协程共享相同的地址空间与系统资源

___d.影响关系___

一个进程的崩溃对其他进程的影响较小，而一个线程的崩溃可能导致整个进程都死掉



__进程通信方式__

___a.共享内存___

在通信的进程之间存在一块可直接访问的共享空间，通过对这片共享空间进行写/读操作实现进程之间的信息交换

___b.消息队列___

进程间通过发送消息和接受消息两个原语进行数据交换，像发邮件一样

___c.管道___

实际上是用于连接一个读进程和一个写进程的共享文件，发送进程以字符流形式将数据写入管道，接收进程从管道中读数据

___d.socket___

可实现不同主机上的进程之间的通信



__进程同步方式__

___a.临界区___

当多个线程访问一个独占性共享资源时，可以使用临界区对象，拥有临界区的线程可以访问被保护起来的资源或代码，如果其他线程想访问则被挂起来，直到拥有临界区的线程放弃临界区

___b.互斥量___

和临界区很像，但是可以实现不同进程的线程之间的通信。互斥对象只有一个，只有拥有互斥对象的线程可以访问资源

___c.信号量___

信号量记录了当前还可以使用某一资源的线程数，如果为零则所有尝试访问此资源的线程都会被阻塞，只有当信号量大于零的时候会被唤起，信号量的更改通过原子操作实现



---

#### 虚拟内存 ####

---

__什么是虚拟内存__

每个进程的运行都需要一定的内存，如果运行的进程过多或进程占用的内存过大就会发生内存不足的情况，在物理内存有限的情况下，为了扩充逻辑内存，就提出了虚拟内存技术，实际上是利用一部分硬盘空间充当内存



__虚拟内存地址到物理地址的映射过程__

通过进程内的页表实现，页表记录了虚拟内存的页号和实际物理地址的块号之间的映射关系，虚拟内存地址分为两部分，页号和页内偏移量，寻址时通过页号在页表内查找到对应的块号的物理地址，再加上块内偏移量得到实际的物理地址



__什么是快表__