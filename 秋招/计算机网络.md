## 计算机网络 ##



__TCP和UDP的区别__

- TCP是面向连接的，可靠性高；UDP是基于非连接的，可靠性低

- 由于TCP是连接的通信，需要有三次握手、重新确认等连接过程，会有延时，实时性差，同时过程复杂，也使其易于攻击；UDP没有建立连接的过程，因而实时性较强，也稍安全

- 在传输相同大小的数据时，TCP首部开销20字节；UDP首部开销8字节，TCP报头比UDP复杂，故实际包含的用户数据较少。TCP在IP协议的基础上添加了序号机制、确认机制、超时重传机制等，保证了传输的可靠性，不会出现丢包或乱序，而UDP有丢包，故TCP开销大，UDP开销较小

- 每条TCP连接只能是点到点的；UDP支持一对一、一对多、多对一、多对多的交互通信

应用场景选择

- 对实时性要求高和高速传输的场合下使用UDP;在可靠性要求低，追求效率的情况下使用UDP

- 需要传输大量数据且对可靠性要求高的情况下使用TCP

---

__输入url到显示网页的过程__

- 输入网址

- DNS解析

- 建立tcp连接

- 客户端发送HTPP请求

- 服务器处理请求

- 服务器响应请求

- 浏览器展示HTML

- 浏览器发送请求获取其他在HTML中的资源

---

#### TCP连接三次握手和四次挥手 ####

---

__TCP三次握手__

三次握手的目的是确认双方的接收能力和发送能力是否正常

___第一次握手___

客户端向服务器发送连接请求报文，报文头部的同步位 SYN=1，同时选择一个初始的序列号 seq=x，此时客户端进入同步已发送状态

___第二次握手___

TCP服务器收到请求报文后，如果同意连接，则会向客户端发出确认报文，确认报文中 ACK=1，SYN=1， 确认号是 ack=x+1，同时也要为自己初始化一个序列号 seq=y，此时服务器进入同步收到状态

___第三次握手___

客户端收到确认后，还要向服务器给出确认，确认报文中 ACK=1，ack=y+1，自己的序列号 seq=x+1，此时TCP连接建立，客户端进入已建立连接状态

___为什么进行第三次握手？___

防止已经失效的连接请求报文突然又传送到了服务器端，从而造成错误



__TCP四次挥手__

___第一次挥手___

客户端发出连接释放报文，并且停止发送数据，报文首部 FIN=1，其序列号为 seq=u（等于前面传送过来的数据的最后一个字节的序号加1），此时客户端进入终止等待1状态

___第二次挥手___

服务器接收到连接释放报文后，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号 seq=v，此时服务端进入关闭等待状态

___第三次挥手___

客户端收到服务器端的确认请求后，客户端就会进入终止等待2状态，等待服务器发送连接释放报文，服务器将最后的数据发送完毕后，就会向客户端发送连接释放报文，此时服务器进入最后确认状态，等待客户端确认

___第四次挥手___

客户端收到服务器端的连接释放报文后，必须发出确认，ACK=1，ack=w+1，自己的序列号为 u+1，此时客户端进入时间等待状态，但是此时 TCP 连接还未终止，必须要经过2ms后，当客户端撤销掉相应的 TCB 后才会进入关闭状态，服务器端收到确认报文后会立即进入关闭状态

___为什么需要第三次挥手？___

此时服务器端数据还没有发送完，客户端进入关闭状态会造成错误

___为什么三次握手四次挥手？___

因为释放连接时，服务器端的确认接收到客户端释放连接报文和服务器本身的释放连接报文是分开传输的，而建立连接时可以一次传输完成，区别在于释放连接时服务端还有数据需要处理，不能立即发送连接释放报文

___为什么客户端要等待2ms？___

有可能客户端最后发送的确认报文没有到达服务器，客户端要等待服务器端重新发送的连接释放报文，然后再次发送确认报文

